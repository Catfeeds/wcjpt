var _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
    return typeof t;
} : function(t) {
    return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t;
};

!function(t, e) {
    "object" == ("undefined" == typeof exports ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define(e) : t.weCropper = e();
}(void 0, function() {
    function i(o) {
        for (var n = [], t = arguments.length - 1; 0 < t--; ) n[t] = arguments[t + 1];
        e.forEach(function(t, e) {
            void 0 !== n[e] && (o[t] = n[e]);
        });
    }
    function l(t) {
        return "function" == typeof t;
    }
    var o = void 0, e = [ "touchstarted", "touchmoved", "touchended" ], n = {}, c = {
        id: {
            default: "cropper",
            get: function() {
                return n.id;
            },
            set: function(t) {
                "string" != typeof t && console.error("id：" + t + " is invalid"), n.id = t;
            }
        },
        width: {
            default: 750,
            get: function() {
                return n.width;
            },
            set: function(t) {
                "number" != typeof t && console.error("width：" + t + " is invalid"), n.width = t;
            }
        },
        height: {
            default: 750,
            get: function() {
                return n.height;
            },
            set: function(t) {
                "number" != typeof t && console.error("height：" + t + " is invalid"), n.height = t;
            }
        },
        scale: {
            default: 2.5,
            get: function() {
                return n.scale;
            },
            set: function(t) {
                "number" != typeof t && console.error("scale：" + t + " is invalid"), n.scale = t;
            }
        },
        zoom: {
            default: 5,
            get: function() {
                return n.zoom;
            },
            set: function(t) {
                "number" != typeof t ? console.error("zoom：" + t + " is invalid") : (t < 0 || 10 < t) && console.error("zoom should be ranged in 0 ~ 10"), 
                n.zoom = t;
            }
        },
        src: {
            default: "cropper",
            get: function() {
                return n.src;
            },
            set: function(t) {
                "string" != typeof t && console.error("id：" + t + " is invalid"), n.src = t;
            }
        },
        cut: {
            default: {},
            get: function() {
                return n.cut;
            },
            set: function(t) {
                "object" != (void 0 === t ? "undefined" : _typeof(t)) && console.error("id：" + t + " is invalid"), 
                n.cut = t;
            }
        },
        onReady: {
            default: null,
            get: function() {
                return n.ready;
            },
            set: function(t) {
                n.ready = t;
            }
        },
        onBeforeImageLoad: {
            default: null,
            get: function() {
                return n.beforeImageLoad;
            },
            set: function(t) {
                n.beforeImageLoad = t;
            }
        },
        onImageLoad: {
            default: null,
            get: function() {
                return n.imageLoad;
            },
            set: function(t) {
                n.imageLoad = t;
            }
        },
        onBeforeDraw: {
            default: null,
            get: function() {
                return n.beforeDraw;
            },
            set: function(t) {
                n.beforeDraw = t;
            }
        }
    }, t = {
        touchStart: function(t) {
            var e = t.touches, o = e[0], n = e[1];
            i(this, !0, null, null), this.__oneTouchStart(o), 2 <= t.touches.length && this.__twoTouchStart(o, n);
        },
        touchMove: function(t) {
            var e = t.touches, o = e[0], n = e[1];
            i(this, null, !0), 1 === t.touches.length && this.__oneTouchMove(o), 2 <= t.touches.length && this.__twoTouchMove(o, n);
        },
        touchEnd: function(t) {
            i(this, !1, !1, !0), this.__xtouchEnd();
        }
    }, r = function(t) {
        var e, o, n = {};
        return e = this, o = c, Object.defineProperties(e, o), Object.keys(c).forEach(function(t) {
            n[t] = c[t].default;
        }), Object.assign(this, n, t), this.prepare(), this.attachPage(), this.createCtx(), 
        this.observer(), this.cutt(), this.methods(), this.init(), this.update(), this;
    };
    return r.prototype.init = function() {
        var t = this.src;
        return this.version = "1.1.5", "function" == typeof this.onReady && this.onReady(this.ctx, this), 
        t && this.pushOrign(t), i(this, !1, !1, !1), this.oldScale = 1, this.newScale = 1, 
        this;
    }, Object.assign(r.prototype, t), r.prototype.prepare = function() {
        var e = this, t = (o || (o = wx.getSystemInfoSync()), o).windowWidth;
        e.attachPage = function() {
            var t = getCurrentPages();
            t[t.length - 1].wecropper = e;
        }, e.createCtx = function() {
            var t = e.id;
            t ? e.ctx = wx.createCanvasContext(t) : console.error("constructor: create canvas context failed, 'id' must be valuable");
        }, e.deviceRadio = t / 750;
    }, r.prototype.observer = function() {
        var n = this, i = [ "ready", "beforeImageLoad", "beforeDraw", "imageLoad" ];
        n.on = function(t, e) {
            return -1 < i.indexOf(t) ? "function" == typeof e && ("ready" === t ? e(n) : n["on" + (o = t, 
            o.charAt(0).toUpperCase() + o.slice(1))] = e) : console.error("event: " + t + " is invalid"), 
            n;
            var o;
        };
    }, r.prototype.methods = function() {
        var r = this, a = r.deviceRadio, t = r.width, e = r.height, o = r.cut, s = o.x;
        void 0 === s && (s = 0);
        var u = o.y;
        void 0 === u && (u = 0);
        var h = o.width;
        void 0 === h && (h = t);
        var d = o.height;
        void 0 === d && (d = e), r.updateCanvas = function() {
            return r.croperTarget && r.ctx.drawImage(r.croperTarget, r.imgLeft, r.imgTop, r.scaleWidth, r.scaleHeight), 
            l(r.onBeforeDraw) && r.onBeforeDraw(r.ctx, r), r.setBoundStyle(), r.ctx.draw(), 
            r;
        }, r.pushOrign = function(t) {
            return r.src = t, l(r.onBeforeImageLoad) && r.onBeforeImageLoad(r.ctx, r), wx.getImageInfo({
                src: t,
                success: function(t) {
                    var e = t.width / t.height;
                    r.croperTarget = t.path, console.log(s, u), e < h / d ? (r.rectX = s, r.baseWidth = h, 
                    r.baseHeight = h / e, r.rectY = u - Math.abs((d - r.baseHeight) / 2)) : (r.rectY = u, 
                    r.baseWidth = d * e, r.baseHeight = d, r.rectX = s - Math.abs((h - r.baseWidth) / 2)), 
                    r.imgLeft = r.rectX, r.imgTop = r.rectY, r.scaleWidth = r.baseWidth, r.scaleHeight = r.baseHeight, 
                    r.updateCanvas(), l(r.onImageLoad) && r.onImageLoad(r.ctx, r);
                }
            }), r.update(), r;
        }, r.getCropperImage = function() {
            for (var t = [], e = arguments.length; e--; ) t[e] = arguments[e];
            var o = r.id, n = toString.call(t[0]), i = t[t.length - 1];
            switch (n) {
              case "[object Object]":
                var c = t[0].quality;
                void 0 === c && (c = 10), "number" != typeof c ? console.error("quality：" + c + " is invalid") : (c < 0 || 10 < c) && console.error("quality should be ranged in 0 ~ 10"), 
                wx.canvasToTempFilePath({
                    canvasId: o,
                    x: s,
                    y: u,
                    width: h,
                    height: d,
                    destWidth: h * c / (10 * a),
                    destHeight: d * c / (10 * a),
                    success: function(t) {
                        l(i) && i.call(r, t.tempFilePath);
                    },
                    fail: function(t) {
                        l(i) && i.call(r, null);
                    }
                });
                break;

              case "[object Function]":
                wx.canvasToTempFilePath({
                    canvasId: o,
                    x: s,
                    y: u,
                    width: h,
                    height: d,
                    destWidth: h / a,
                    destHeight: d / a,
                    success: function(t) {
                        l(i) && i.call(r, t.tempFilePath);
                    },
                    fail: function(t) {
                        l(i) && i.call(r, null);
                    }
                });
            }
            return r;
        };
    }, r.prototype.cutt = function() {
        var i = this, c = i.width, r = i.height, t = i.cut, a = t.x;
        void 0 === a && (a = 0);
        var s = t.y;
        void 0 === s && (s = 0);
        var u = t.width;
        void 0 === u && (u = c);
        var h = t.height;
        void 0 === h && (h = r), i.outsideBound = function(t, e) {
            i.imgLeft = a <= t ? a : i.scaleWidth + t - a <= u ? a + u - i.scaleWidth : t, i.imgTop = s <= e ? s : i.scaleHeight + e - s <= h ? s + h - i.scaleHeight : e;
        }, i.setBoundStyle = function(t) {
            void 0 === t && (t = {});
            var e = t.color;
            void 0 === e && (e = "#04b00f");
            var o = t.mask;
            void 0 === o && (o = "rgba(0, 0, 0, 0.3)");
            var n = t.lineWidth;
            void 0 === n && (n = 1), i.ctx.beginPath(), i.ctx.setFillStyle(o), i.ctx.fillRect(0, 0, a, r), 
            i.ctx.fillRect(a, 0, u, s), i.ctx.fillRect(a, s + h, u, r - s - h), i.ctx.fillRect(a + u, 0, c - a - u, r), 
            i.ctx.fill(), i.ctx.beginPath(), i.ctx.setStrokeStyle(e), i.ctx.setLineWidth(n), 
            i.ctx.moveTo(a - n, s + 10 - n), i.ctx.lineTo(a - n, s - n), i.ctx.lineTo(a + 10 - n, s - n), 
            i.ctx.stroke(), i.ctx.beginPath(), i.ctx.setStrokeStyle(e), i.ctx.setLineWidth(n), 
            i.ctx.moveTo(a - n, s + h - 10 + n), i.ctx.lineTo(a - n, s + h + n), i.ctx.lineTo(a + 10 - n, s + h + n), 
            i.ctx.stroke(), i.ctx.beginPath(), i.ctx.setStrokeStyle(e), i.ctx.setLineWidth(n), 
            i.ctx.moveTo(a + u - 10 + n, s - n), i.ctx.lineTo(a + u + n, s - n), i.ctx.lineTo(a + u + n, s + 10 - n), 
            i.ctx.stroke(), i.ctx.beginPath(), i.ctx.setStrokeStyle(e), i.ctx.setLineWidth(n), 
            i.ctx.moveTo(a + u + n, s + h - 10 + n), i.ctx.lineTo(a + u + n, s + h + n), i.ctx.lineTo(a + u - 10 + n, s + h + n), 
            i.ctx.stroke();
        };
    }, r.prototype.update = function() {
        var u = this;
        u.src && (u.__oneTouchStart = function(t) {
            u.touchX0 = t.x, u.touchY0 = t.y;
        }, u.__oneTouchMove = function(t) {
            var e, o;
            if (u.touchended) return u.updateCanvas();
            e = t.x - u.touchX0, o = t.y - u.touchY0;
            var n = u.rectX + e, i = u.rectY + o;
            u.outsideBound(n, i), u.updateCanvas();
        }, u.__twoTouchStart = function(t, e) {
            var o, n, i;
            u.touchX1 = u.rectX + u.scaleWidth / 2, u.touchY1 = u.rectY + u.scaleHeight / 2, 
            o = e.x - t.x, n = e.y - t.y, i = Math.sqrt(o * o + n * n), u.oldDistance = i;
        }, u.__twoTouchMove = function(t, e) {
            var o, n, i, c = u.scale, r = u.zoom;
            o = e.x - t.x, n = e.y - t.y, i = Math.sqrt(o * o + n * n), u.newScale = u.oldScale + .001 * r * (i - u.oldDistance), 
            u.newScale <= 1 && (u.newScale = 1), u.newScale >= c && (u.newScale = c), u.scaleWidth = u.newScale * u.baseWidth, 
            u.scaleHeight = u.newScale * u.baseHeight;
            var a = u.touchX1 - u.scaleWidth / 2, s = u.touchY1 - u.scaleHeight / 2;
            u.outsideBound(a, s), u.updateCanvas();
        }, u.__xtouchEnd = function() {
            u.oldScale = u.newScale, u.rectX = u.imgLeft, u.rectY = u.imgTop;
        });
    }, r;
});